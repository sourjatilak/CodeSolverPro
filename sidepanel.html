<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CodeSolver Pro</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
        <h1>CodeSolver Pro</h1>
      </div>
      <div class="header-center">
        <span id="currentTabName" class="tab-name">Loading...</span>
      </div>
      <div class="header-actions">
        <!-- Background Processing Indicator -->
        <div id="processingIndicator" class="processing-indicator hidden">
          <div class="processing-icon-wrapper">
            <svg class="processing-spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
              <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
            </svg>
          </div>
          <div id="processingTooltip" class="processing-tooltip">
            <div class="tooltip-header">
              <span>Generating Solutions</span>
              <button id="closeTooltipBtn" class="close-tooltip-btn" title="Close">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <div class="tooltip-content-scroll">
              <div id="processingProfilesList" class="processing-profiles-list">
                <!-- Active profiles will be dynamically added here -->
              </div>
            </div>
            <div class="tooltip-footer">Working in background...</div>
          </div>
        </div>
        <button id="refreshBtn" class="icon-btn" title="Refresh Detection">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
            <path d="M3 3v5h5"/>
            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
            <path d="M16 21h5v-5"/>
          </svg>
        </button>
        <button id="settingsBtn" class="icon-btn" title="Settings">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m-9-9h6m6 0h6M4.93 4.93l4.24 4.24m5.66 5.66 4.24 4.24M4.93 19.07l4.24-4.24m5.66-5.66 4.24-4.24"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Status Banner -->
    <div id="statusBanner" class="status-banner hidden">
      <span id="statusText"></span>
      <button id="closeBanner" class="close-banner">&times;</button>
    </div>

    <!-- Detection Status -->
    <div class="detection-status">
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span class="status-text" id="statusTextMain">Detecting...</span>
      </div>
    </div>

    <!-- Problem Card -->
    <div id="problemCard" class="problem-card hidden">
      <div class="problem-header">
        <span id="platformBadge" class="platform-badge">LeetCode</span>
        <span id="difficultyBadge" class="difficulty-badge">Medium</span>
      </div>
      <h2 id="problemTitle" class="problem-title">Problem Title</h2>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="description">Description</button>
        <button class="tab" data-tab="solution">Solution</button>
        <button class="tab" data-tab="explanation">Explanation</button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        <div id="descriptionTab" class="tab-pane active">
          <div id="problemDescription" class="problem-description">
            Problem description will appear here...
          </div>
          <div id="problemConstraints" class="problem-constraints">
            <strong>Constraints:</strong>
            <pre id="constraintsText"></pre>
          </div>
          <div id="problemExamples" class="problem-examples">
            <strong>Examples:</strong>
            <pre id="examplesText"></pre>
          </div>
        </div>

        <div id="solutionTab" class="tab-pane">
          <div id="solutionContainer" class="solution-container">
            <div id="noSolution" class="no-solution">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <p>Click "Solve Problem" to get AI-powered solution</p>
            </div>
            <div id="solutionLoading" class="solution-loading hidden">
              <div class="spinner"></div>
              <p>Generating solution...</p>
            </div>
            <div id="solutionHeader" class="solution-header hidden">
              <div class="solution-header-left">
                <h3>Solution</h3>
                <div class="solution-language-selector">
                  <label for="solutionLanguageSelect">Language:</label>
                  <select id="solutionLanguageSelect" class="language-dropdown">
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="typescript">TypeScript</option>
                    <option value="java">Java</option>
                    <option value="cpp">C++</option>
                    <option value="c">C</option>
                    <option value="csharp">C#</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="ruby">Ruby</option>
                    <option value="php">PHP</option>
                    <option value="swift">Swift</option>
                    <option value="kotlin">Kotlin</option>
                    <option value="scala">Scala</option>
                  </select>
                </div>
              </div>
              <div style="display: flex; gap: 8px;">
                <button id="removeSolutionBtn" class="btn-secondary" style="color: var(--error);">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                  Remove
                </button>
                <button id="copySolutionBtn" class="btn-secondary">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                  </svg>
                  Copy
                </button>
              </div>
            </div>
            <div id="solutionContent" class="solution-content hidden">
              <pre id="solutionCode" class="code-block"></pre>
              <div class="complexity-info">
                <strong>Complexity:</strong>
                <span id="complexityText"></span>
              </div>
            </div>
          </div>

          <!-- Profile Selector -->
          <div class="profile-selector-container">
            <label for="profileSelect" class="profile-selector-label">AI Profile:</label>
            <select id="profileSelect" class="profile-selector-dropdown">
              <!-- Profiles will be dynamically added here -->
            </select>
            <span id="profileStatus" class="profile-status-indicator"></span>
          </div>

          <div id="problemMeta" class="problem-meta">
            <span class="language-label">Using language:</span>
            <select id="languageSelector" class="language-selector">
              <option value="python">Python</option>
              <option value="javascript">JavaScript</option>
              <option value="typescript">TypeScript</option>
              <option value="java">Java</option>
              <option value="cpp">C++</option>
              <option value="c">C</option>
              <option value="csharp">C#</option>
              <option value="go">Go</option>
              <option value="rust">Rust</option>
              <option value="ruby">Ruby</option>
              <option value="php">PHP</option>
              <option value="swift">Swift</option>
              <option value="kotlin">Kotlin</option>
              <option value="scala">Scala</option>
            </select>
          </div>

          <button id="solveBtn" class="btn-primary solve-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
            </svg>
            Solve Problem
          </button>
        </div>

        <div id="explanationTab" class="tab-pane">
          <div id="explanationContent" class="explanation-content">
            <p class="placeholder-text">Solve the problem first to see detailed explanation.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- No Problem State -->
    <div id="noProblemCard" class="no-problem-card">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
        <path d="M11 8v6M8 11h6"/>
      </svg>
      <h2>No Coding Problem Detected</h2>
      <p>Navigate to a supported platform:</p>
      <ul class="platform-list">
        <li>LeetCode / LeetCode China</li>
        <li>HackerRank</li>
        <li>CodeSignal</li>
        <li>Codeforces</li>
        <li>Codewars</li>
        <li>InterviewBit</li>
        <li>HackerEarth</li>
        <li>AlgoExpert</li>
        <li>BinarySearch</li>
        <li>CSES / AtCoder</li>
      </ul>
      <button id="refreshDetectionBtn" class="btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
          <path d="M16 21h5v-5"/>
        </svg>
        Refresh Detection
      </button>
    </div>

    <!-- Not Whitelisted State -->
    <div id="notWhitelistedCard" class="not-whitelisted-card hidden">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"></path>
      </svg>
      <h2>Website Not Whitelisted</h2>
      <p>This website is not enabled for CodeSolver Pro.</p>
      <div class="url-display" id="notWhitelistedUrl">https://example.com</div>
      <p style="font-size: 12px; color: var(--text-secondary);">You can whitelist this website in Settings to use the extension here.</p>
      <button id="openSettingsWhitelistBtn" class="btn-primary">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v6m0 6v6m-9-9h6m6 0h6M4.93 4.93l4.24 4.24m5.66 5.66 4.24 4.24M4.93 19.07l4.24-4.24m5.66-5.66 4.24-4.24"/>
        </svg>
        Open Settings
      </button>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>AI Profiles</h2>
          <button id="closeSettings" class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Profiles List Section -->
          <div class="setting-group">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <label style="margin: 0;">Profiles</label>
              <button id="addProfileBtn" class="btn-secondary" style="padding: 4px 8px; font-size: 11px;">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Profile
              </button>
            </div>
            <div id="profilesList" class="profiles-list">
              <!-- Profiles will be dynamically added here -->
            </div>
          </div>

          <hr style="border: none; border-top: 1px solid var(--border-color); margin: 16px 0;">

          <!-- Profile Configuration Form -->
          <div id="profileConfigForm">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <h3 style="font-size: 14px; font-weight: 600; margin: 0;">Profile Configuration</h3>
              <div style="display: flex; gap: 4px;">
                <button id="deleteProfileBtn" class="btn-secondary" style="padding: 4px 8px; font-size: 11px; color: var(--error); display: none;">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                  Delete
                </button>
                <button id="saveProfileBtn" class="btn-primary" style="padding: 4px 12px; font-size: 11px;">Save Profile</button>
              </div>
            </div>

            <div class="setting-group">
              <label for="profileName">Profile Name</label>
              <input type="text" id="profileName" placeholder="My AI Profile">
            </div>

            <div class="setting-group">
              <label for="apiProvider">AI Provider</label>
              <select id="apiProvider">
                <option value="openai">OpenAI (GPT-4)</option>
                <option value="anthropic">Anthropic (Claude)</option>
                <option value="llama">Llama Server (llama.cpp)</option>
                <option value="local">Local LLM (Ollama)</option>
              </select>
            </div>

            <div class="setting-group">
              <label for="apiKey">API Key</label>
              <input type="password" id="apiKey" placeholder="Enter your API key">
              <small>Your key is stored locally in your browser</small>
            </div>

            <div class="setting-group" id="localUrlGroup" style="display: none;">
              <label for="localUrl">Local LLM URL</label>
              <input type="text" id="localUrl" placeholder="http://localhost:11434/v1/chat/completions" value="http://localhost:11434/v1/chat/completions">
            </div>

            <div class="setting-group" id="llamaUrlGroup" style="display: none;">
              <label for="llamaUrl">Llama Server URL</label>
              <input type="text" id="llamaUrl" placeholder="http://localhost:8080/v1/chat/completions" value="http://localhost:8080/v1/chat/completions">
            </div>

            <div class="setting-group">
              <label for="modelSelect">Model</label>
              <input type="text" id="modelSelect" placeholder="gpt-4" value="gpt-4">
            </div>

            <div class="setting-group">
              <label for="temperature">Temperature (0.0 - 2.0)</label>
              <input type="number" id="temperature" placeholder="0.2" value="0.2" min="0" max="2" step="0.1">
              <small>Lower = more focused, Higher = more creative</small>
            </div>

            <div class="setting-group">
              <label for="maxTokens">Max Tokens</label>
              <input type="number" id="maxTokens" placeholder="4096" value="4096" min="100" max="32000" step="100">
              <small>Maximum length of the response</small>
            </div>

            <div class="setting-group">
              <label for="topP">Top P (0.0 - 1.0)</label>
              <input type="number" id="topP" placeholder="1.0" value="1.0" min="0" max="1" step="0.05">
              <small>Nucleus sampling parameter</small>
            </div>

            <div class="setting-group">
              <label for="systemPrompt">System Prompt</label>
              <textarea id="systemPrompt" rows="3" placeholder="You are an expert coding interviewer...">You are an expert coding interviewer. Always respond with valid JSON in the exact format requested.</textarea>
              <small>Customize how the AI behaves when solving problems</small>
            </div>
          </div>

          <hr style="border: none; border-top: 1px solid var(--border-color); margin: 16px 0;">

          <!-- General Settings -->
          <div class="setting-group">
            <label>
              <input type="checkbox" id="autoDetect" checked>
              Auto-detect problems
            </label>
          </div>

          <div class="setting-group">
            <label for="busyTimeout">Profile Busy Timeout (minutes)</label>
            <input type="number" id="busyTimeout" value="5" min="1" max="60" step="1">
            <small>Automatically clear stuck "working" profiles after this time</small>
          </div>

          <hr style="border: none; border-top: 1px solid var(--border-color); margin: 16px 0;">

          <!-- Website & Profiles Management -->
          <div class="setting-group">
            <label>Website &amp; Profiles Management</label>

            <!-- Profiles Import/Export -->
            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px;">
              <button id="exportProfilesBtn" class="btn-secondary" style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export Profiles
              </button>
              <button id="importProfilesBtn" class="btn-secondary" style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Import Profiles
              </button>
            </div>

            <!-- Website Whitelist -->
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <label style="margin: 0; font-size: 13px;">Website Whitelist</label>
              </div>
              <div id="whitelistContainer" class="whitelist-container">
                <!-- Whitelist items will be dynamically added here -->
              </div>
              <div style="display: flex; gap: 8px; margin-top: 8px;">
                <input type="text" id="newWebsiteInput" class="new-website-input" placeholder="Enter website URL (e.g., https://example.com)">
                <button id="addWebsiteBtn" class="btn-secondary" style="white-space: nowrap;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  Add
                </button>
              </div>
              <small style="margin-top: 6px; display: block;">Add websites where you want to use the extension. Default coding platforms cannot be modified.</small>
            </div>
          </div>

          <hr style="border: none; border-top: 1px solid var(--border-color); margin: 16px 0;">

          <div class="setting-group">
            <label>Solution Management</label>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button id="exportSolutionsBtn" class="btn-secondary" style="flex: 1;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Export XML
              </button>
              <button id="clearSolutionsBtn" class="btn-secondary" style="flex: 1; color: var(--error);">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Clear All
              </button>
            </div>
            <small>Export all solutions to XML or clear stored solutions</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Focus Protection Indicator -->
    <div class="focus-protection-indicator" title="Focus Protection Active">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
      </svg>
      <span>Protected</span>
    </div>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
